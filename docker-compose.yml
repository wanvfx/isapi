version: '3.8'

services:
  isapi:
    build: .
    container_name: isapi
    ports:
      - "15130:15130"
    environment:
      - PORT=15130
      - REFRESH_INTERVAL=5
    volumes:
      - /proc:/proc:ro
      - /sys:/sys:ro
      - /etc:/etc:ro
    # 减少权限，提高安全性
    cap_add:
      - NET_ADMIN
      - SYS_ADMIN
    security_opt:
      - seccomp:unconfined
    restart: unless-stopped
    # 添加健康检查
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "15130"]
      interval: 30s
      timeout: 10s
      retries: 3